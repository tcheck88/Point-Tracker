{% extends "base.html" %}
{% block title %}{{ _('Edit Student') }}{% endblock %}

{% block content %}
<div style="max-width: 600px; margin: 0 auto;">
    <div style="margin-bottom: 20px;">
        <a href="{{ url_for('student_profile', student_id=student_id) }}" style="color: #64748b; text-decoration: none;">&larr; {{ _('Back to Profile') }}</a>
    </div>

    <div class="card" style="background: white; padding: 32px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
        <h1 style="margin-top: 0; color: #0f172a;">{{ _('Edit Student Details') }}</h1>
        <p style="color: #64748b; margin-bottom: 24px;">{{ _('Update the information below.') }}</p>

        <form id="editForm" onsubmit="updateStudent(event)">
            
            <div style="margin-bottom: 16px;">
                <label style="display: block; font-weight: 600; font-size: 13px; margin-bottom: 6px;">{{ _('Full Name') }} <span style="color:red">*</span></label>
                <input type="text" id="full_name" required style="width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px;">
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                <div>
                    <label style="display: block; font-weight: 600; font-size: 13px; margin-bottom: 6px;">{{ _('Classroom / Homeroom') }}</label>
                    <input type="text" id="classroom" style="width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px;">
                </div>
                <div>
                    <label style="display: block; font-weight: 600; font-size: 13px; margin-bottom: 6px;">{{ _('Grade Level') }}</label>
                    <select id="grade" style="width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; background: white;">
                        <option value="">{{ _('Select Grade') }}</option>
                        <option value="K">Kindergarten</option>
                        <option value="1">1st Grade</option>
                        <option value="2">2nd Grade</option>
                        <option value="3">3rd Grade</option>
                        <option value="4">4th Grade</option>
                        <option value="5">5th Grade</option>
                        <option value="6">6th Grade</option>
						<option value="7">7th Grade</option>
						<option value="8">8th Grade</option>
						<option value="9">9th Grade</option>
                    </select>
                </div>
            </div>

            <h3 style="font-size: 14px; text-transform: uppercase; color: #94a3b8; border-bottom: 1px solid #f1f5f9; padding-bottom: 8px; margin-top: 30px;">{{ _('Parent / Contact Info') }}</h3>
            
            <div style="margin-bottom: 16px;">
                <label style="display: block; font-weight: 600; font-size: 13px; margin-bottom: 6px;">{{ _('Parent Name') }}</label>
                <input type="text" id="parent_name" style="width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px;">
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                <div>
                    <label style="display: block; font-weight: 600; font-size: 13px; margin-bottom: 6px;">{{ _('Phone Number') }}</label>
                    <input type="tel" id="phone" style="width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px;">
                </div>
                <div>
                    <label style="display: block; font-weight: 600; font-size: 13px; margin-bottom: 6px;">{{ _('Email Address') }}</label>
                    <input type="email" id="email" style="width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px;">
                </div>
            </div>

            <button type="submit" class="btn btn-primary" style="width: 100%; padding: 12px; font-weight: 700; margin-top: 10px;">
                {{ _('Save Changes') }}
            </button>
        </form>
    </div>
</div>

<script>
    const studentId = {{ student_id }};
    const _ = (s) => s; // Placeholder

    // Load Data on Start
    document.addEventListener('DOMContentLoaded', async () => {
        try {
            const res = await fetch(`/api/student/${studentId}`);
            const data = await res.json();
            
            if (data.success) {
                const s = data.student;
                document.getElementById('full_name').value = s.full_name || '';
                document.getElementById('classroom').value = s.classroom || '';
                document.getElementById('grade').value = s.grade || '';
                document.getElementById('parent_name').value = s.parent_name || '';
                document.getElementById('phone').value = s.phone || '';
                document.getElementById('email').value = s.email || '';
            } else {
                alert('Error loading student data.');
            }
        } catch (e) {
            console.error(e);
        }
    });

    async function updateStudent(e) {
        e.preventDefault();
        
        const payload = {
            full_name: document.getElementById('full_name').value,
            classroom: document.getElementById('classroom').value,
            grade: document.getElementById('grade').value,
            parent_name: document.getElementById('parent_name').value,
            phone: document.getElementById('phone').value,
            email: document.getElementById('email').value
        };

        try {
            const res = await fetch(`/api/student/${studentId}/update`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(payload)
            });
            
            const result = await res.json();
            
            if (result.success) {
                alert(result.message);
                // Redirect back to profile
                window.location.href = `/student/${studentId}`;
            } else {
                alert('Error: ' + result.message);
            }
        } catch (err) {
            console.error(err);
            alert(_('Failed to update student.'));
        }
    }
</script>
{% endblock %}