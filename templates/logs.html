<!DOCTYPE html>
<html lang="{{ get_locale() }}">
<head>
  <meta charset="utf-8" />
  <title>{{ _('System Logs - Leer MÃ©xico') }}</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Inter', sans-serif; background: #f1f5f9; padding: 20px; color: #334155; }
    .wrap { max-width: 1000px; margin: 0 auto; background: #fff; padding: 24px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    h1 { margin: 0; font-size: 20px; color: #0f172a; }
    .actions { display: flex; gap: 10px; }
    button, .btn { padding: 8px 14px; border-radius: 6px; font-weight: 600; cursor: pointer; border: none; font-size: 13px; text-decoration: none; display: inline-flex; align-items: center; }
    .btn-primary { background: #3b82f6; color: white; }
    .btn-danger { background: #ef4444; color: white; }
    .btn-secondary { background: #e2e8f0; color: #475569; }
    #log-viewer { background: #1e293b; color: #e2e8f0; font-family: 'Monaco', 'Consolas', monospace; font-size: 12px; padding: 15px; border-radius: 8px; height: 500px; overflow-y: auto; white-space: pre-wrap; line-height: 1.5; border: 1px solid #334155; }
    .log-entry { border-bottom: 1px solid #334155; padding: 2px 0; }
    .log-error { color: #f87171; font-weight: bold; }
    .log-info { color: #bfdbfe; }
    .log-warn { color: #fcd34d; }
  </style>
</head>
<body>
<div class="wrap">
    <header>
        <div>
            <h1>{{ _('System Logs') }}</h1>
            <a href="{{ url_for('index') }}" style="font-size: 13px; color: #64748b; text-decoration: none;">&larr; {{ _('Back to Dashboard') }}</a>
        </div>
        <div class="actions">
            <button class="btn btn-secondary" onclick="fetchLogs()">ðŸ”„ {{ _('Refresh') }}</button>
            <a href="/api/logs/download" class="btn btn-primary">â¬‡ {{ _('Download Full Log') }}</a>
            <button class="btn btn-danger" onclick="confirmClear()">ðŸ—‘ {{ _('Clear Logs') }}</button>
        </div>
    </header>
    <div id="log-viewer">{{ _('Loading system logs...') }}</div>
</div>
<script>
    const _ = (s) => s;
    async function fetchLogs() {
        const viewer = document.getElementById('log-viewer');
        try {
            const res = await fetch('/api/logs/view');
            const data = await res.json();
            if (data.logs && data.logs.length > 0) {
                viewer.innerHTML = data.logs.map(line => {
                    let className = 'log-entry';
                    if (line.includes('ERROR') || line.includes('CRITICAL')) className += ' log-error';
                    else if (line.includes('WARNING')) className += ' log-warn';
                    else className += ' log-info';
                    return `<div class="${className}">${line}</div>`;
                }).join('');
                viewer.scrollTop = viewer.scrollHeight;
            } else {
                viewer.textContent = _("No logs found.");
            }
        } catch (e) {
            viewer.textContent = _("Error loading logs: ") + e;
        }
    }
    async function confirmClear() {
        if (confirm(_("Are you sure? This will archive the current log file and start a fresh one."))) {
            try {
                const res = await fetch('/api/logs/clear', { method: 'POST' });
                const data = await res.json();
                if (data.success) {
                    alert(_("Logs cleared!"));
                    fetchLogs();
                } else {
                    alert(_("Error: ") + data.message);
                }
            } catch (e) {
                alert(_("Network error: ") + e);
            }
        }
    }
    document.addEventListener('DOMContentLoaded', fetchLogs);
    setInterval(fetchLogs, 10000);
</script>
</body>
</html>