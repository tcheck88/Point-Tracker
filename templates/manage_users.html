{% extends "base.html" %}
{% block title %}{{ _('User Management') }}{% endblock %}

{% block content %}
<div style="max-width: 950px; margin: 0 auto; background: white; padding: 24px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <div>
            <a href="{{ url_for('index') }}" style="color: #1f6feb; text-decoration: none; font-size: 13px;">&larr; {{ _('Back to Dashboard') }}</a>
            <h1 style="margin: 8px 0 0; color: #0f172a; font-size: 22px;">{{ _('User Management') }}</h1>
        </div>
    </div>

    {% if msg %}
    <div style="background: #eff6ff; color: #1e40af; padding: 10px; border-radius: 6px; font-size: 13px; margin-bottom: 20px; border: 1px solid #bfdbfe;">
        {{ msg }}
    </div>
    {% endif %}

    <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 16px; margin-bottom: 24px;">
        <h3 style="margin-top: 0; font-size: 14px; color: #334155; margin-bottom: 12px;">{{ _('Create New User') }}</h3>
        <form action="{{ url_for('create_user') }}" method="POST" style="display: flex; gap: 10px; align-items: flex-end; flex-wrap: wrap;">
            
            <div style="flex: 1; min-width: 150px;">
                <label style="display: block; font-size: 11px; font-weight: 600; color: #64748b; margin-bottom: 4px;">{{ _('Username') }}</label>
                <input type="text" name="username" required placeholder="jdoe" style="width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 13px;">
            </div>

            <div style="flex: 1; min-width: 150px;">
                <label style="display: block; font-size: 11px; font-weight: 600; color: #64748b; margin-bottom: 4px;">{{ _('Password') }}</label>
                <input type="password" name="password" required placeholder="****" style="width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 13px;">
            </div>

            <div style="width: 140px;">
                <label style="display: block; font-size: 11px; font-weight: 600; color: #64748b; margin-bottom: 4px;">{{ _('Role') }}</label>
                <select name="role" style="width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 13px; background: white;">
                    <option value="staff">Staff</option>
                    <option value="admin">Admin</option>
                    {% if session.get('role') == 'sysadmin' %}
                    <option value="sysadmin">SysAdmin</option>
                    {% endif %}
                </select>
            </div>

            <button type="submit" style="padding: 9px 16px; background: #166534; color: white; border: none; border-radius: 6px; font-weight: 600; font-size: 13px; cursor: pointer;">
                {{ _('Create User') }}
            </button>
        </form>
    </div>

    <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
        <thead>
            <tr style="background: #f8fafc; border-bottom: 2px solid #e2e8f0; text-align: left;">
                <th style="padding: 12px;">{{ _('ID') }}</th>
                <th style="padding: 12px;">{{ _('Username') }}</th>
                <th style="padding: 12px;">{{ _('Role') }}</th>
                <th style="padding: 12px;">{{ _('Status') }}</th>
                <th style="padding: 12px; text-align: right;">{{ _('Actions') }}</th>
            </tr>
        </thead>
        <tbody>
            {% for u in users %}
            <tr style="border-bottom: 1px solid #f1f5f9; {% if not u.active %} background-color: #fcfcfc; color: #94a3b8; {% endif %}">
                
                <td style="padding: 12px; color: #64748b;">{{ u.id }}</td>
                <td style="padding: 12px; font-weight: 600;">{{ u.username }}</td>
                
                <td style="padding: 12px;">
                    {% if u.role == 'sysadmin' %}
                        <span style="background: #e0e7ff; color: #3730a3; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 700; text-transform: uppercase; border: 1px solid #c7d2fe;">SYSADMIN</span>
                    {% elif u.role == 'admin' %}
                        <span style="background: #dcfce7; color: #166534; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 700; text-transform: uppercase;">ADMIN</span>
                    {% else %}
                        <span style="background: #f1f5f9; color: #475569; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 700; text-transform: uppercase;">STAFF</span>
                    {% endif %}
                </td>

                <td style="padding: 12px;">
                    {% if u.active %}
                        <span style="color: #166534; font-weight: 600; font-size: 12px; display: flex; align-items: center; gap: 4px;">
                            <span style="width: 8px; height: 8px; background: #16a34a; border-radius: 50%;"></span> Active
                        </span>
                    {% else %}
                        <span style="color: #991b1b; font-weight: 600; font-size: 12px; display: flex; align-items: center; gap: 4px; background: #fef2f2; padding: 2px 8px; border-radius: 12px; width: fit-content; border: 1px solid #fecaca;">
                            Inactive
                        </span>
                    {% endif %}
                </td>

                <td style="padding: 12px; text-align: right; display: flex; gap: 8px; justify-content: flex-end; align-items: center;">
                    
                    <form action="{{ url_for('toggle_user_status') }}" method="POST" style="margin: 0;">
                        <input type="hidden" name="user_id" value="{{ u.id }}">
                        {% if u.active %}
                            <button type="submit" title="{{ _('Deactivate User') }}" style="background: white; border: 1px solid #e2e8f0; color: #ef4444; padding: 5px 10px; border-radius: 4px; font-size: 11px; font-weight: 600; cursor: pointer; transition: 0.2s;" onmouseover="this.style.borderColor='#ef4444'; this.style.background='#fef2f2'" onmouseout="this.style.borderColor='#e2e8f0'; this.style.background='white'">
                                ðŸš« {{ _('Deactivate') }}
                            </button>
                        {% else %}
                            <button type="submit" title="{{ _('Activate User') }}" style="background: white; border: 1px solid #e2e8f0; color: #166534; padding: 5px 10px; border-radius: 4px; font-size: 11px; font-weight: 600; cursor: pointer; transition: 0.2s;" onmouseover="this.style.borderColor='#16a34a'; this.style.background='#f0fdf4'" onmouseout="this.style.borderColor='#e2e8f0'; this.style.background='white'">
                                âœ… {{ _('Activate') }}
                            </button>
                        {% endif %}
                    </form>

                    <form action="{{ url_for('admin_reset_password') }}" method="POST" style="display: inline-flex; gap: 6px; align-items: center;" onsubmit="return confirm('{{ _('Are you sure you want to reset this password?') }}');">
                        <input type="hidden" name="user_id" value="{{ u.id }}">
                        <input type="password" name="new_pass" placeholder="{{ _('New Pass') }}" required style="padding: 4px 8px; border: 1px solid #cbd5e1; border-radius: 4px; font-size: 12px; width: 120px;">
                        <button type="submit" style="background: #3b82f6; color: white; border: none; padding: 5px 10px; border-radius: 4px; font-size: 11px; font-weight: 600; cursor: pointer;">
                            {{ _('Reset') }}
                        </button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}